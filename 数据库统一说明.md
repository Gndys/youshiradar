# 数据库统一说明

## ✅ 已完成的统一工作

所有工具现在使用相同的 IndexedDB 数据库结构：

### 数据库信息
- **数据库名称**: `YouTubeToolDB`
- **数据库版本**: `4`
- **存储位置**: 浏览器本地 IndexedDB

### 数据存储结构

| 存储名称 | 用途 | 主键 | 使用工具 |
|---------|------|------|---------|
| `settings` | 通用设置 | key | 所有工具 |
| `apiPool` | API池管理 | id (自增) | 所有工具共享 |
| `channels` | 博主管理数据 | channelId | 博主管理工具 |
| `monitorChannels` | 监控博主列表 | channelId | 视频监控工具 |
| `monitorVideos` | 监控视频数据 | videoId | 视频监控工具 |

## 🔑 API池共享机制

三个工具现在共享同一个 API 池：

1. **统一管理**: 在 `API池管理工具.html` 中添加/删除/管理所有 API
2. **自动同步**: 任何工具中对 API 的修改都会立即同步到其他工具
3. **智能切换**: 当 API 配额用尽时，自动切换到下一个可用 API
4. **状态追踪**: 
   - `active`: 可用的 API
   - `exhausted`: 配额已用尽的 API
   - `disabled`: 手动禁用的 API

## 🔄 如何使用

### 首次使用

1. **打开任意工具**，数据库会自动创建
2. **进入 API池管理工具**，添加你的 YouTube API Keys
3. **在其他工具中使用**，会自动加载可用的 API

### 如果遇到问题

如果工具之间数据不互通或出现错误：

#### 方法 1：刷新页面（推荐）
1. 关闭所有工具页面
2. 重新打开，数据库会自动升级到版本 4

#### 方法 2：清除并重建数据库
1. 打开浏览器开发者工具 (F12)
2. 进入 Application/应用程序 标签
3. 找到 IndexedDB > YouTubeToolDB
4. 右键点击，选择 "Delete database"
5. 刷新页面，数据库会自动重建

#### 方法 3：使用控制台命令
打开控制台 (F12)，输入：
```javascript
indexedDB.deleteDatabase('YouTubeToolDB');
```
然后刷新页面。

## 📊 数据隔离说明

虽然三个工具共享 API 池，但各自的数据是独立的：

- **爆款挖掘工具**: 不持久化搜索结果（仅临时存储）
- **博主管理工具**: 使用 `channels` 存储
- **视频监控工具**: 使用 `monitorChannels` 和 `monitorVideos` 存储

这样设计既保证了 API 池共享，又避免了数据混乱。

## 🎯 版本历史

- **v1-v3**: 旧版本，存在兼容性问题
- **v4**: 当前版本，统一所有存储结构

## 💡 提示

1. **定期备份**: 使用各工具的"导出数据"功能备份重要数据
2. **API管理**: 在 API 池中添加多个 API Key，避免配额限制
3. **浏览器兼容**: 建议使用 Chrome/Edge/Firefox 最新版本
4. **存储空间**: IndexedDB 通常有几百MB到几GB的存储空间，足够使用

## 🔍 调试信息

打开浏览器控制台，你会看到类似的日志：
```
数据库升级: 3 -> 4
创建 monitorChannels 存储
创建 monitorVideos 存储
数据库结构创建完成
数据库初始化成功，版本: 4
✅ 已加载 3 个可用API
```

如果看到这些日志，说明数据库已成功升级。

---

**最后更新**: 2024年
**维护者**: Cursor AI

