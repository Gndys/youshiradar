<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘æ•°æ®è¯Šæ–­å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #0a0a0a;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #E60012;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .info-box {
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .info-box h2 {
            color: #E60012;
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .stat-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .stat {
            background: #0f0f0f;
            padding: 15px 20px;
            border-radius: 6px;
            border: 1px solid #2a2a2a;
        }
        
        .stat-label {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            color: #fff;
            font-size: 24px;
            font-weight: bold;
        }
        
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .video-item {
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }
        
        .video-item:hover {
            border-color: #E60012;
            box-shadow: 0 4px 12px rgba(230, 0, 18, 0.3);
        }
        
        .video-item img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            border: 2px solid #2a2a2a;
            margin-bottom: 10px;
            display: block;
            background: #0f0f0f;
        }
        
        .video-title {
            color: #fff;
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .video-info {
            color: #888;
            font-size: 12px;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .status.ok {
            background: #0a5f0a;
            color: #00ff00;
        }
        
        .status.warning {
            background: #5f3b0a;
            color: #ffaa00;
        }
        
        .status.error {
            background: #5f0a0a;
            color: #ff0000;
        }
        
        .btn {
            background: #E60012;
            color: #fff;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #ff1122;
            box-shadow: 0 4px 12px rgba(230, 0, 18, 0.5);
        }
        
        .btn-secondary {
            background: #1a1a1a;
            border: 2px solid #2a2a2a;
        }
        
        .btn-secondary:hover {
            background: #2a2a2a;
            border-color: #E60012;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        pre {
            background: #0f0f0f;
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            font-size: 12px;
            color: #0f0;
        }
        
        .problem-videos {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š è§†é¢‘æ•°æ®è¯Šæ–­å·¥å…·</h1>
        
        <div class="actions">
            <button class="btn" onclick="runDiagnostics()">ğŸ” è¿è¡Œè¯Šæ–­</button>
            <button class="btn btn-secondary" onclick="fixThumbnails()">ğŸ”§ ä¿®å¤ç¼©ç•¥å›¾</button>
            <button class="btn btn-secondary" onclick="clearCache()">ğŸ—‘ï¸ æ¸…é™¤ç¼“å­˜</button>
            <a href="chuhai.html" class="btn btn-secondary" style="display: inline-block; text-decoration: none; line-height: 1;">â† è¿”å›ä¸»é¡µ</a>
        </div>
        
        <div class="info-box">
            <h2>æ•°æ®ç»Ÿè®¡</h2>
            <div class="stat-row" id="statsContainer">
                <div class="stat">
                    <div class="stat-label">åŠ è½½ä¸­...</div>
                    <div class="stat-value">-</div>
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h2>è¯Šæ–­ç»“æœ</h2>
            <div id="diagnosticsResult">
                <p style="color: #888;">ç‚¹å‡»"è¿è¡Œè¯Šæ–­"æŒ‰é’®å¼€å§‹æ£€æŸ¥...</p>
            </div>
        </div>
        
        <div class="info-box problem-videos">
            <h2>é—®é¢˜è§†é¢‘åˆ—è¡¨</h2>
            <div id="problemVideos">
                <p style="color: #888;">æš‚æ— æ•°æ®</p>
            </div>
        </div>
        
        <div class="info-box">
            <h2>æ‰€æœ‰è§†é¢‘é¢„è§ˆ</h2>
            <div class="video-grid" id="videoGrid">
                <p style="color: #888;">åŠ è½½ä¸­...</p>
            </div>
        </div>
    </div>
    
    <script>
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadData() {
            try {
                const savedData = localStorage.getItem('youtubeChannelMonitor');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    return {
                        channels: data.channels || [],
                        videos: data.videos || [],
                        apiKey: data.apiKey || ''
                    };
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
            return { channels: [], videos: [], apiKey: '' };
        }
        
        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function showStats() {
            const data = loadData();
            const videosWithThumbnail = data.videos.filter(v => v.thumbnail).length;
            const videosWithoutThumbnail = data.videos.filter(v => !v.thumbnail).length;
            const videosWithVideoId = data.videos.filter(v => v.videoId || v.id).length;
            const videosWithoutVideoId = data.videos.filter(v => !v.videoId && !v.id).length;
            
            const html = `
                <div class="stat">
                    <div class="stat-label">é¢‘é“æ€»æ•°</div>
                    <div class="stat-value">${data.channels.length}</div>
                </div>
                <div class="stat">
                    <div class="stat-label">è§†é¢‘æ€»æ•°</div>
                    <div class="stat-value">${data.videos.length}</div>
                </div>
                <div class="stat">
                    <div class="stat-label">æœ‰ç¼©ç•¥å›¾</div>
                    <div class="stat-value" style="color: #00ff00;">${videosWithThumbnail}</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ç¼ºå°‘ç¼©ç•¥å›¾</div>
                    <div class="stat-value" style="color: ${videosWithoutThumbnail > 0 ? '#ff0000' : '#00ff00'};">${videosWithoutThumbnail}</div>
                </div>
                <div class="stat">
                    <div class="stat-label">æœ‰VideoID</div>
                    <div class="stat-value" style="color: #00ff00;">${videosWithVideoId}</div>
                </div>
                <div class="stat">
                    <div class="stat-label">ç¼ºå°‘VideoID</div>
                    <div class="stat-value" style="color: ${videosWithoutVideoId > 0 ? '#ff0000' : '#00ff00'};">${videosWithoutVideoId}</div>
                </div>
            `;
            
            document.getElementById('statsContainer').innerHTML = html;
        }
        
        // è¿è¡Œè¯Šæ–­
        function runDiagnostics() {
            const data = loadData();
            const problems = [];
            const warnings = [];
            const info = [];
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
            if (data.videos.length === 0) {
                problems.push('âŒ æ²¡æœ‰è§†é¢‘æ•°æ®');
            } else {
                info.push(`âœ… æ‰¾åˆ° ${data.videos.length} ä¸ªè§†é¢‘`);
            }
            
            // æ£€æŸ¥ç¼©ç•¥å›¾
            const videosWithoutThumbnail = data.videos.filter(v => !v.thumbnail);
            if (videosWithoutThumbnail.length > 0) {
                warnings.push(`âš ï¸ ${videosWithoutThumbnail.length} ä¸ªè§†é¢‘ç¼ºå°‘ç¼©ç•¥å›¾`);
            } else if (data.videos.length > 0) {
                info.push('âœ… æ‰€æœ‰è§†é¢‘éƒ½æœ‰ç¼©ç•¥å›¾');
            }
            
            // æ£€æŸ¥videoId
            const videosWithoutVideoId = data.videos.filter(v => !v.videoId && !v.id);
            if (videosWithoutVideoId.length > 0) {
                problems.push(`âŒ ${videosWithoutVideoId.length} ä¸ªè§†é¢‘ç¼ºå°‘videoId`);
            } else if (data.videos.length > 0) {
                info.push('âœ… æ‰€æœ‰è§†é¢‘éƒ½æœ‰videoId');
            }
            
            // æ£€æŸ¥ç¼©ç•¥å›¾URLæœ‰æ•ˆæ€§
            const invalidThumbnails = data.videos.filter(v => {
                if (!v.thumbnail) return false;
                return !v.thumbnail.startsWith('http');
            });
            if (invalidThumbnails.length > 0) {
                warnings.push(`âš ï¸ ${invalidThumbnails.length} ä¸ªè§†é¢‘çš„ç¼©ç•¥å›¾URLæ ¼å¼ä¸æ­£ç¡®`);
            }
            
            // æ˜¾ç¤ºè¯Šæ–­ç»“æœ
            let resultHtml = '';
            
            if (problems.length > 0) {
                resultHtml += '<div style="color: #ff0000; margin-bottom: 15px;">';
                resultHtml += '<h3 style="margin-bottom: 10px;">ä¸¥é‡é—®é¢˜ï¼š</h3>';
                problems.forEach(p => {
                    resultHtml += `<p style="margin: 5px 0;">${p}</p>`;
                });
                resultHtml += '</div>';
            }
            
            if (warnings.length > 0) {
                resultHtml += '<div style="color: #ffaa00; margin-bottom: 15px;">';
                resultHtml += '<h3 style="margin-bottom: 10px;">è­¦å‘Šï¼š</h3>';
                warnings.forEach(w => {
                    resultHtml += `<p style="margin: 5px 0;">${w}</p>`;
                });
                resultHtml += '</div>';
            }
            
            if (info.length > 0) {
                resultHtml += '<div style="color: #00ff00; margin-bottom: 15px;">';
                resultHtml += '<h3 style="margin-bottom: 10px;">æ­£å¸¸ï¼š</h3>';
                info.forEach(i => {
                    resultHtml += `<p style="margin: 5px 0;">${i}</p>`;
                });
                resultHtml += '</div>';
            }
            
            if (problems.length === 0 && warnings.length === 0) {
                resultHtml = '<p style="color: #00ff00; font-size: 18px; font-weight: bold;">âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼æ•°æ®å®Œæ•´æ— è¯¯ã€‚</p>';
            }
            
            document.getElementById('diagnosticsResult').innerHTML = resultHtml;
            
            // æ˜¾ç¤ºé—®é¢˜è§†é¢‘
            showProblemVideos(videosWithoutThumbnail, videosWithoutVideoId);
        }
        
        // æ˜¾ç¤ºé—®é¢˜è§†é¢‘
        function showProblemVideos(noThumbnail, noVideoId) {
            if (noThumbnail.length === 0 && noVideoId.length === 0) {
                document.getElementById('problemVideos').innerHTML = '<p style="color: #00ff00;">âœ… æ²¡æœ‰é—®é¢˜è§†é¢‘</p>';
                return;
            }
            
            let html = '';
            
            if (noThumbnail.length > 0) {
                html += '<h3 style="color: #ffaa00; margin-bottom: 10px;">ç¼ºå°‘ç¼©ç•¥å›¾çš„è§†é¢‘ï¼š</h3>';
                html += '<pre>' + JSON.stringify(noThumbnail.slice(0, 5).map(v => ({
                    title: v.title,
                    videoId: v.videoId || v.id || '(æ— )',
                    channelTitle: v.channelTitle
                })), null, 2) + '</pre>';
            }
            
            if (noVideoId.length > 0) {
                html += '<h3 style="color: #ff0000; margin-bottom: 10px; margin-top: 20px;">ç¼ºå°‘videoIdçš„è§†é¢‘ï¼š</h3>';
                html += '<pre>' + JSON.stringify(noVideoId.slice(0, 5).map(v => ({
                    title: v.title,
                    thumbnail: v.thumbnail ? 'æœ‰' : 'æ— ',
                    channelTitle: v.channelTitle
                })), null, 2) + '</pre>';
            }
            
            document.getElementById('problemVideos').innerHTML = html;
        }
        
        // ä¿®å¤ç¼©ç•¥å›¾
        function fixThumbnails() {
            const data = loadData();
            let fixedCount = 0;
            
            data.videos.forEach(video => {
                // ä¿®å¤videoId
                if (!video.videoId && video.id) {
                    video.videoId = video.id;
                    fixedCount++;
                }
                
                // ä¿®å¤ç¼©ç•¥å›¾
                if (!video.thumbnail && video.videoId) {
                    video.thumbnail = `https://i.ytimg.com/vi/${video.videoId}/hqdefault.jpg`;
                    fixedCount++;
                }
            });
            
            // ä¿å­˜ä¿®å¤åçš„æ•°æ®
            localStorage.setItem('youtubeChannelMonitor', JSON.stringify({
                channels: data.channels,
                videos: data.videos,
                apiKey: data.apiKey
            }));
            
            alert(`âœ… ä¿®å¤å®Œæˆï¼å…±ä¿®å¤ ${fixedCount} ä¸ªé—®é¢˜ã€‚\n\nè¯·åˆ·æ–°ä¸»é¡µæŸ¥çœ‹æ•ˆæœã€‚`);
            
            // é‡æ–°åŠ è½½ç»Ÿè®¡å’Œè¯Šæ–­
            showStats();
            runDiagnostics();
            showAllVideos();
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰è§†é¢‘
        function showAllVideos() {
            const data = loadData();
            
            if (data.videos.length === 0) {
                document.getElementById('videoGrid').innerHTML = '<p style="color: #888;">æš‚æ— è§†é¢‘æ•°æ®</p>';
                return;
            }
            
            let html = '';
            data.videos.slice(0, 20).forEach(video => {
                const videoId = video.videoId || video.id || '';
                const thumbnail = video.thumbnail || (videoId ? `https://i.ytimg.com/vi/${videoId}/hqdefault.jpg` : '');
                const hasVideoId = videoId ? 'ok' : 'error';
                const hasThumbnail = video.thumbnail ? 'ok' : 'warning';
                
                html += `
                <div class="video-item">
                    <img src="${thumbnail || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'169\'%3E%3Crect fill=\'%232a2a2a\' width=\'300\' height=\'169\'/%3E%3Ctext fill=\'%23E60012\' font-size=\'16\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3Eæ— å›¾ç‰‡%3C/text%3E%3C/svg%3E'}" 
                         alt="${video.title}"
                         onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'169\'%3E%3Crect fill=\'%232a2a2a\' width=\'300\' height=\'169\'/%3E%3Ctext fill=\'%23E60012\' font-size=\'16\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3EåŠ è½½å¤±è´¥%3C/text%3E%3C/svg%3E';">
                    <div class="video-title">${video.title || 'æœªçŸ¥æ ‡é¢˜'}</div>
                    <div class="video-info">
                        <span class="status ${hasVideoId}">${videoId ? 'VideoID: âœ“' : 'VideoID: âœ—'}</span>
                        <span class="status ${hasThumbnail}">${video.thumbnail ? 'ç¼©ç•¥å›¾: âœ“' : 'ç¼©ç•¥å›¾: âœ—'}</span>
                    </div>
                    <div class="video-info" style="margin-top: 5px;">
                        ${video.channelTitle || 'æœªçŸ¥åšä¸»'}
                    </div>
                </div>`;
            });
            
            if (data.videos.length > 20) {
                html += `<p style="color: #888; grid-column: 1 / -1; text-align: center;">æ˜¾ç¤ºå‰20ä¸ªè§†é¢‘ï¼Œå…± ${data.videos.length} ä¸ª</p>`;
            }
            
            document.getElementById('videoGrid').innerHTML = html;
        }
        
        // æ¸…é™¤ç¼“å­˜
        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰é¢‘é“å’Œè§†é¢‘æ•°æ®ï¼')) {
                localStorage.removeItem('youtubeChannelMonitor');
                alert('âœ… ç¼“å­˜å·²æ¸…é™¤');
                location.reload();
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            showStats();
            runDiagnostics();
            showAllVideos();
        });
    </script>
</body>
</html>

