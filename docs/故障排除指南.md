# 🔧 故障排除指南

## 常见问题及解决方案

### 问题1: 存储状态检查工具一直显示"正在检查存储状态..."

**原因**: IndexedDB 初始化失败或数据库结构损坏

**解决方案**:

1. **方法一：刷新页面**
   - 按 `Cmd+R` (Mac) 或 `Ctrl+R` (Windows) 刷新页面
   - 如果还不行，按 `Cmd+Shift+R` (Mac) 或 `Ctrl+Shift+R` (Windows) 强制刷新

2. **方法二：检查浏览器控制台**
   - 按 `F12` 打开开发者工具
   - 切换到 "Console"（控制台）标签
   - 查看是否有红色错误信息
   - 截图发送给技术支持

3. **方法三：重置数据库**
   - 如果存储检查工具能打开，点击 "🔧 重置数据库" 按钮
   - 或者手动删除：
     1. 打开浏览器开发者工具 (F12)
     2. 切换到 "Application"（应用）标签
     3. 左侧找到 "IndexedDB"
     4. 删除 "YouTubeToolDB" 数据库
     5. 刷新页面

---

### 问题2: 添加博主时显示错误

**可能的错误信息和解决方案**:

#### 错误: "数据库结构需要更新，请刷新页面后重试"

**原因**: 数据库版本不匹配

**解决方案**:
1. 刷新页面 (`Cmd+Shift+R` 或 `Ctrl+Shift+R`)
2. 如果还不行，重置数据库（见上文）

#### 错误: "保存失败: ..."

**原因**: 数据保存时出错

**解决方案**:
1. 检查浏览器磁盘空间是否充足
2. 关闭其他使用该工具的标签页
3. 重启浏览器
4. 重置数据库

#### 错误: "YouTube Data API v3 has not been used..."

**原因**: API Key 未启用或配额已用完

**解决方案**:
1. 检查 API Key 是否正确
2. 访问 [Google Cloud Console](https://console.developers.google.com/)
3. 启用 YouTube Data API v3
4. 检查 API 配额是否用完

---

### 问题3: 数据丢失

**预防措施**:
- ✅ 定期使用 "📤 导出数据" 功能备份
- ✅ 不要在隐私模式/无痕模式下使用
- ✅ 不要清除浏览器数据（会删除 IndexedDB）

**数据恢复**:

1. **检查 localStorage（旧数据）**
   ```javascript
   // 在浏览器控制台运行
   console.log(localStorage.getItem('youtubeChannels'));
   ```

2. **导入备份文件**
   - 如果有导出的 CSV 文件
   - 使用 "📥 批量导入" 功能
   - 从 CSV 中复制频道 ID

3. **重新添加**
   - 如果数据量不大，手动重新添加

---

### 问题4: 工具运行缓慢

**原因**: 数据量过大或浏览器资源不足

**解决方案**:

1. **清理不需要的博主**
   - 删除不再关注的博主
   - 减少数据量

2. **导出并重新开始**
   - 导出当前数据
   - 清空数据库
   - 只导入需要的博主

3. **使用筛选功能**
   - 使用搜索、地区、标签筛选
   - 减少显示的数据量

4. **关闭其他标签页**
   - 释放浏览器内存

---

### 问题5: 批量导入失败

**常见原因**:

1. **API 配额用完**
   - YouTube API 每天有配额限制
   - 等待第二天重试
   - 或使用新的 API Key

2. **频道 ID 格式错误**
   - 确保每行一个频道 ID
   - ID 格式: `UCxxxxxxxxxxxxxxxxxx` (24个字符)
   - 或完整的 YouTube URL

3. **网络问题**
   - 检查网络连接
   - 重试失败的频道

4. **存储空间不足**
   - 导入过多博主时可能触发
   - 分批导入
   - 或清理现有数据

---

## 完全重置指南

如果遇到无法解决的问题，可以完全重置：

### 步骤1: 备份数据（重要！）
1. 打开 "02 YouTube博主管理工具.html"
2. 点击 "📤 导出数据"
3. 保存 CSV 文件

### 步骤2: 清理浏览器数据
1. 打开浏览器设置
2. 清除浏览器数据
3. 选择：
   - ✅ Cookie 和其他网站数据
   - ✅ 缓存的图片和文件
   - ⚠️ 时间范围：选择 "全部时间"

### 步骤3: 重置数据库
1. 打开 "../utilities/存储状态检查.html"
2. 点击 "🔧 重置数据库"
3. 确认删除

### 步骤4: 重新开始
1. 刷新页面
2. 重新输入 API Key
3. 使用 "📥 批量导入" 导入备份的数据

---

## 浏览器特定问题

### Chrome/Edge
- 如果遇到 "Quota exceeded" 错误
  - 检查：`chrome://settings/content/all`
  - 清除该网站的存储

### Firefox
- 如果 IndexedDB 被禁用
  - 访问：`about:config`
  - 搜索：`dom.indexedDB.enabled`
  - 设置为：`true`

### Safari
- 隐私设置可能阻止 IndexedDB
  - 设置 > Safari > 隐私
  - 关闭 "阻止所有 Cookie"

---

## 获取帮助

### 收集错误信息

在报告问题前，请收集以下信息：

1. **浏览器信息**
   - 浏览器名称和版本
   - 操作系统

2. **错误信息**
   ```javascript
   // 在控制台运行，复制结果
   console.log(navigator.userAgent);
   ```

3. **控制台错误**
   - 按 F12 打开控制台
   - 截图所有红色错误信息

4. **存储状态**
   - 打开 "../utilities/存储状态检查.html"
   - 截图所有显示的信息

### 调试技巧

**查看 IndexedDB 数据**:
1. 按 F12 打开开发者工具
2. 切换到 "Application"（应用）标签
3. 展开 "IndexedDB" > "YouTubeToolDB"
4. 查看 settings 和 channels 数据

**手动清除数据**:
```javascript
// 在控制台运行
indexedDB.deleteDatabase('YouTubeToolDB');
localStorage.clear();
location.reload();
```

**检查存储配额**:
```javascript
// 在控制台运行
navigator.storage.estimate().then(estimate => {
  console.log('已使用:', (estimate.usage / 1024 / 1024).toFixed(2), 'MB');
  console.log('总配额:', (estimate.quota / 1024 / 1024).toFixed(2), 'MB');
  console.log('使用率:', ((estimate.usage / estimate.quota) * 100).toFixed(2), '%');
});
```

---

## 预防性维护

### 定期维护建议

1. **每周**:
   - 导出数据备份
   - 检查存储状态

2. **每月**:
   - 清理不需要的博主
   - 更新博主信息（批量刷新）

3. **遇到问题时**:
   - 先导出数据
   - 再尝试修复
   - 最后考虑重置

### 最佳实践

✅ **推荐做法**:
- 定期导出数据备份
- 使用正常浏览模式（非隐私模式）
- 不要同时打开多个工具标签页
- API Key 妥善保管

❌ **避免操作**:
- 不要在隐私/无痕模式下使用
- 不要频繁清除浏览器数据
- 不要在多个标签页同时操作数据
- 不要存储超过需要的博主数据

---

## 版本兼容性

### 从旧版本升级

如果从 localStorage 版本升级：
1. 首次打开会自动迁移数据
2. 确认数据迁移成功后
3. 可以清理旧的 localStorage 数据

### 降级到旧版本

不建议降级，但如果必须：
1. 导出当前数据
2. 使用旧版本工具
3. 手动导入数据

---

**最后更新**: 2025-10-14

